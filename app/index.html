<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Professional kinetic typography motion design tool with real-time parameter controls and preset management">
    <title>TT K1n3t1c - Motion Design</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://www.territory-influence.com/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.territory-influence.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.territory-influence.com/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.territory-influence.com/apple-touch-icon.png">

    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Open Props - Modern CSS Design Tokens -->
    <link rel="stylesheet" href="https://unpkg.com/open-props" />
    <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css" />

    <!-- Coloris - Modern Color Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>

    <!-- Styles -->
    <link rel="stylesheet" href="./styles/theme.css">
    <link rel="stylesheet" href="./styles/main-modern.css">
    <link rel="stylesheet" href="./styles/help-overlay.css">
    <link rel="stylesheet" href="./styles/settings-overlay.css">
    <link rel="stylesheet" href="./styles/notifications.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Three.js via CDN (v0.115.0) -->
    <script src="https://unpkg.com/three@0.115.0/build/three.min.js"></script>
    <!-- OrbitControls for camera interaction -->
    <script src="https://unpkg.com/three@0.115.0/examples/js/controls/OrbitControls.js"></script>
    <!-- Post-Processing for Glitch Effect -->
    <script src="https://unpkg.com/three@0.115.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://unpkg.com/three@0.115.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://unpkg.com/three@0.115.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://unpkg.com/three@0.115.0/examples/js/shaders/CopyShader.js"></script>
    <!-- Fallback CDN if unpkg fails -->
    <script>
        if (typeof THREE === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r115/three.min.js"><\/script>');
        }
    </script>
</head>
<body>
    <div id="app" class="app">
        <!-- Toolbar -->
        <header id="toolbar" class="toolbar">
            <div class="toolbar__left">
                <h1 class="toolbar__logo">TT K1n3t1c</h1>
            </div>
            <div class="toolbar__center">
                <select id="effect-selector" class="effect-selector">
                    <option value="">Loading effects...</option>
                </select>
                <!-- Compact Preset Management -->
                <select id="preset-selector" class="preset-selector">
                    <option value="">No preset selected</option>
                </select>
                <button id="save-preset-btn" class="btn-icon" title="Save preset">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M219.31,80,176,36.69A15.86,15.86,0,0,0,164.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V91.31A15.86,15.86,0,0,0,219.31,80ZM168,208H88V152h80Zm40,0H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H164.69L208,91.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z"/></svg>
                </button>
                <button id="import-preset-btn" class="btn-icon" title="Import preset">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"/></svg>
                </button>
            </div>
            <div class="toolbar__right">
                <div id="fps-counter" class="fps-counter" style="display: none;">
                    <span id="fps-value">60</span> FPS
                </div>
                <button id="settings-btn" class="btn-icon" title="Settings (G)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8.06,8.06,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8.06,8.06,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"/></svg>
                </button>
                <button id="help-btn" class="btn-icon" title="Help (H)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"/></svg>
                </button>
                <button id="ui-toggle-btn" class="btn-icon" title="Toggle UI (Space)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"/></svg>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="content-wrapper">
            <!-- Settings Panel (Left Sidebar) -->
            <aside id="settings-panel" class="settings-sidebar">
                <div class="settings-sidebar__header">
                    <h2>Settings</h2>
                    <div class="settings-sidebar__actions">
                        <button id="reset-settings-btn" class="btn-icon" title="Reset to default (R)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"/></svg>
                        </button>
                        <button id="export-settings-btn" class="btn-icon" title="Export settings (E)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M216,112v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V112A16,16,0,0,1,56,96h40a8,8,0,0,1,0,16H56v96H200V112H160a8,8,0,0,1,0-16h40A16,16,0,0,1,216,112ZM93.66,69.66,120,43.31V136a8,8,0,0,0,16,0V43.31l26.34,26.35a8,8,0,0,0,11.32-11.32l-40-40a8,8,0,0,0-11.32,0l-40,40A8,8,0,0,0,93.66,69.66Z"/></svg>
                        </button>
                    </div>
                </div>
                <div id="settings-content" class="settings-sidebar__content">
                    <!-- Settings controls will be dynamically generated here -->
                </div>
            </aside>

            <!-- Canvas Container -->
            <main class="canvas-container">
                <div id="webgl-container"></div>
                <div id="offline-indicator" class="offline-indicator" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M213.92,210.62a8,8,0,1,1-11.84,10.76L53.92,34.62A8,8,0,1,1,65.08,23.86L98.52,61.07A151.78,151.78,0,0,1,128,56a152,152,0,0,1,95.42,33.67,8,8,0,1,1-10.06,12.48A135.93,135.93,0,0,0,128,72a135.25,135.25,0,0,0-21.12,1.67l20.93,23A103.94,103.94,0,0,1,232,136a8,8,0,0,1-16,0,87.93,87.93,0,0,0-63.8-84.53l21,23.07A71.93,71.93,0,0,1,200,136a8,8,0,0,1-16,0,55.91,55.91,0,0,0-33.35-51.18l45.43,50ZM128,184a40,40,0,0,1-40-40,8,8,0,0,0-16,0,56,56,0,0,0,56,56,8,8,0,0,0,0-16Zm0-32a8,8,0,0,1-8-8,8,8,0,0,0-16,0,24,24,0,0,0,24,24,8,8,0,0,0,0-16Z"/></svg>
                    Offline Mode
                </div>
            </main>
        </div>

        <!-- Controls Panel (Bottom) -->
        <aside id="controls-panel" class="controls-panel">
            <!-- Playback Section -->
            <div class="controls-section">
                <h3 class="controls-section__title">Playback</h3>
                <div class="controls-section__content">
                    <button id="play-pause-btn" class="btn-control">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"/></svg>
                        Pause
                    </button>
                    <div class="speed-control">
                        <label>Speed</label>
                        <input type="range" id="speed-slider" min="0" max="5" step="0.1" value="1">
                        <span id="speed-value">1.0x</span>
                    </div>
                </div>
            </div>

            <!-- Camera Controls Section -->
            <div class="controls-section">
                <h3 class="controls-section__title">Camera</h3>
                <div class="controls-section__content camera-controls-compact">
                    <div class="camera-row">
                        <label>Zoom</label>
                        <input type="range" id="camera-zoom" min="20" max="100" step="1" value="50">
                        <span id="camera-zoom-value">50</span>
                    </div>
                    <div class="camera-row">
                        <label>Pan</label>
                        <input type="range" id="camera-pan-x" min="-50" max="50" step="1" value="0">
                        <span id="camera-pan-x-value">0</span>
                        <input type="range" id="camera-pan-y" min="-50" max="50" step="1" value="0">
                        <span id="camera-pan-y-value">0</span>
                    </div>
                    <div class="camera-row">
                        <label>Rotate</label>
                        <input type="range" id="camera-rotate-x" min="-180" max="180" step="1" value="0">
                        <span id="camera-rotate-x-value">0°</span>
                        <input type="range" id="camera-rotate-y" min="-180" max="180" step="1" value="0">
                        <span id="camera-rotate-y-value">0°</span>
                    </div>
                    <button id="camera-reset-btn" class="btn-text-small">Reset</button>
                </div>
            </div>

            <!-- Toggle Button -->
            <button id="toggle-controls-btn" class="controls-panel__toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"/></svg>
            </button>
        </aside>

        <!-- Help Overlay -->
        <div id="help-overlay" class="help-overlay" style="display: none;">
            <div class="help-overlay__content">
                <div class="help-overlay__header">
                    <h2>Keyboard Shortcuts</h2>
                    <button id="close-help-btn" class="btn-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"/></svg>
                    </button>
                </div>
                <div class="help-overlay__body">
                    <div class="shortcut-group">
                        <h3>Navigation</h3>
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>Toggle UI visibility</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>H</kbd>
                            <span>Show/hide this help</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>F</kbd>
                            <span>Toggle FPS counter</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>Close modals/overlays</span>
                        </div>
                    </div>

                    <div class="shortcut-group">
                        <h3>Camera Controls</h3>
                        <div class="shortcut-item">
                            <kbd>Left Click + Drag</kbd>
                            <span>Pan camera</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Right Click + Drag</kbd>
                            <span>Rotate camera</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Mouse Wheel</kbd>
                            <span>Zoom in/out</span>
                        </div>
                    </div>

                    <div class="shortcut-group">
                        <h3>Effects</h3>
                        <div class="shortcut-item">
                            <kbd>1</kbd> - <kbd>9</kbd>
                            <span>Quick-switch between effects</span>
                        </div>
                    </div>

                    <div class="shortcut-group">
                        <h3>Settings</h3>
                        <div class="shortcut-item">
                            <kbd>R</kbd>
                            <span>Reset to default settings</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>S</kbd>
                            <span>Save as new preset</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>E</kbd>
                            <span>Export settings as JSON</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>I</kbd>
                            <span>Import settings from JSON</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Overlay -->
        <div id="settings-overlay" class="settings-overlay" style="display: none;">
            <div class="settings-overlay__content">
                <div class="settings-overlay__header">
                    <h2>App Settings</h2>
                    <button id="close-settings-btn" class="btn-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"/></svg>
                    </button>
                </div>
                <div class="settings-overlay__body">
                    <!-- Color Swatches Section -->
                    <div class="settings-section">
                        <h3>Default Color Swatches</h3>
                        <p>Customize the default color palette shown in color pickers</p>
                        <div class="color-swatches-grid" id="color-swatches-grid">
                            <!-- Color swatches will be generated here -->
                        </div>
                    </div>

                    <!-- Export/Import Section -->
                    <div class="settings-section">
                        <h3>Export & Import</h3>
                        <p>Save or load your app configuration</p>
                        <div class="settings-actions">
                            <button id="export-app-settings-btn" class="btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" style="margin-right: 8px; vertical-align: middle;"><path d="M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"/></svg>
                                Export Settings
                            </button>
                            <button id="import-app-settings-btn" class="btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" style="margin-right: 8px; vertical-align: middle;"><path d="M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"/></svg>
                                Import Settings
                            </button>
                        </div>
                        <input type="file" id="import-settings-file" accept=".json" style="display: none;">
                    </div>

                    <!-- Save Button -->
                    <div class="settings-actions">
                        <button id="save-app-settings-btn" class="btn btn-primary">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notification-container" class="notification-container"></div>
    </div>

    <!-- Coloris - Modern Color Picker -->
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>

    <!-- Main App (ES6 Module) -->
    <script type="module" src="./js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('✓ ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
