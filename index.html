<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TT K1n3t1c - Professional Kinetic Typography Tool">
    <meta name="theme-color" content="#0a0a0a">

    <title>TT K1n3t1c - Kinetic Typography</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ctext y='24' font-size='24'%3Eâš¡%3C/text%3E%3C/svg%3E">

    <!-- Open Props -->
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.7.3/open-props.min.css">
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.7.3/normalize.min.css">
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.7.3/buttons.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/design-tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Inline SVG Icon Sprite -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <defs>
            <!-- Settings Icon -->
            <symbol id="icon-settings" viewBox="0 0 256 256">
                <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3l-2.64-23.72a8,8,0,0,0-3.93-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.93,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.93,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.93,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"/>
            </symbol>

            <!-- Floppy Disk (Save/Presets) -->
            <symbol id="icon-presets" viewBox="0 0 256 256">
                <path d="M219.31,72,184,36.69A15.86,15.86,0,0,0,172.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V83.31A15.86,15.86,0,0,0,219.31,72ZM168,208H88V152h80Zm40,0H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H172.69L208,83.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z"/>
            </symbol>

            <!-- Camera -->
            <symbol id="icon-camera" viewBox="0 0 256 256">
                <path d="M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z"/>
            </symbol>

            <!-- Film Strip (Timeline) -->
            <symbol id="icon-timeline" viewBox="0 0 256 256">
                <path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM40,72H64V96H40ZM64,184H40V160H64Zm0-72H40V88H64Zm136,72H80V72h120Zm16,0V160h24v24Zm24-40H192V120h24Zm0-40H192V80h24V96Zm0-32H192V56h24Z"/>
            </symbol>

            <!-- Play -->
            <symbol id="icon-play" viewBox="0 0 256 256">
                <path d="M232.4,114.49,88.32,26.35a16,16,0,0,0-16.2-.3A15.86,15.86,0,0,0,64,39.87V216.13A15.86,15.86,0,0,0,72.12,230a16,16,0,0,0,16.2-.3l144.08-88.14a15.81,15.81,0,0,0,0-27ZM80,215.94V40l143.83,88Z"/>
            </symbol>

            <!-- Pause -->
            <symbol id="icon-pause" viewBox="0 0 256 256">
                <path d="M200,32H160a16,16,0,0,0-16,16V208a16,16,0,0,0,16,16h40a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm0,176H160V48h40ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Zm0,176H56V48H96Z"/>
            </symbol>

            <!-- Question (Help) -->
            <symbol id="icon-help" viewBox="0 0 256 256">
                <path d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"/>
            </symbol>

            <!-- User Circle -->
            <symbol id="icon-user" viewBox="0 0 256 256">
                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"/>
            </symbol>

            <!-- Download (Export) -->
            <symbol id="icon-export" viewBox="0 0 256 256">
                <path d="M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"/>
            </symbol>

            <!-- Arrow Counter Clockwise (Reset) -->
            <symbol id="icon-reset" viewBox="0 0 256 256">
                <path d="M224,128a96,96,0,0,1-94.71,96H128A95.38,95.38,0,0,1,62.1,197.8a8,8,0,0,1,11-11.63A80,80,0,1,0,71.43,71.39a3.07,3.07,0,0,1-.26.25L44.59,96H72a8,8,0,0,1,0,16H24a8,8,0,0,1-8-8V56a8,8,0,0,1,16,0V85.8L60.25,60A96,96,0,0,1,224,128Z"/>
            </symbol>

            <!-- Caret Down -->
            <symbol id="icon-caret-down" viewBox="0 0 256 256">
                <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"/>
            </symbol>

            <!-- Lightning (Logo) -->
            <symbol id="icon-logo" viewBox="0 0 256 256">
                <path d="M215.79,118.17a8,8,0,0,0-5-5.66L153.18,90.9l14.66-73.33a8,8,0,0,0-13.69-7l-112,120a8,8,0,0,0,3,13l57.63,21.61L88.16,238.43a8,8,0,0,0,13.69,7l112-120A8,8,0,0,0,215.79,118.17ZM109.37,214l10.47-52.38a8,8,0,0,0-5-9.06L62,132.71l84.62-90.66L136.16,94.43a8,8,0,0,0,5,9.06l52.8,19.8Z"/>
            </symbol>
        </defs>
    </svg>

    <!-- App Container -->
    <div class="app">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar__left">
                <div class="logo">
                    <svg class="icon icon--logo"><use href="#icon-logo"/></svg>
                    <span class="logo__text">TT K1n3t1c</span>
                </div>

                <div class="effect-selector">
                    <button class="effect-selector__button" id="effectSelectorBtn" aria-haspopup="true" aria-expanded="false">
                        <span id="currentEffect">Endless</span>
                        <svg class="icon icon--sm"><use href="#icon-caret-down"/></svg>
                    </button>
                    <div class="effect-selector__dropdown" id="effectDropdown" role="menu" hidden>
                        <button class="effect-option" data-effect="0" role="menuitem">Endless</button>
                        <button class="effect-option" data-effect="1" role="menuitem">Swirl</button>
                        <button class="effect-option" data-effect="2" role="menuitem">Twisted</button>
                        <button class="effect-option" data-effect="3" role="menuitem">Relax</button>
                    </div>
                </div>
            </div>

            <div class="topbar__right">
                <button class="icon-btn" aria-label="Help" title="Help">
                    <svg class="icon"><use href="#icon-help"/></svg>
                </button>
                <button class="icon-btn" id="settingsBtn" aria-label="Settings" title="Settings">
                    <svg class="icon"><use href="#icon-settings"/></svg>
                </button>
                <button class="icon-btn" aria-label="User" title="User">
                    <svg class="icon"><use href="#icon-user"/></svg>
                </button>
            </div>
        </header>

        <!-- Floating Toolbar (Left) -->
        <aside class="toolbar" id="toolbar">
            <button class="icon-btn toolbar__btn" data-tool="presets" aria-label="Presets" title="Presets">
                <svg class="icon"><use href="#icon-presets"/></svg>
            </button>
            <button class="icon-btn toolbar__btn" data-tool="camera" aria-label="Camera" title="Camera Controls">
                <svg class="icon"><use href="#icon-camera"/></svg>
            </button>
            <button class="icon-btn toolbar__btn" data-tool="timeline" aria-label="Timeline" title="Timeline">
                <svg class="icon"><use href="#icon-timeline"/></svg>
            </button>
        </aside>

        <!-- WebGL Canvas Container -->
        <div class="canvas-container">
            <div id="webgl"></div>
        </div>

        <!-- Floating Playback Controls (Bottom) -->
        <div class="playback" id="playback">
            <button class="playback__play icon-btn" id="playBtn" aria-label="Play/Pause">
                <svg class="icon" id="playIcon"><use href="#icon-play"/></svg>
                <svg class="icon" id="pauseIcon" hidden><use href="#icon-pause"/></svg>
            </button>

            <div class="playback__controls">
                <button class="btn btn--secondary" id="resetBtn">
                    <svg class="icon icon--sm"><use href="#icon-reset"/></svg>
                    <span>Reset</span>
                </button>
                <button class="btn btn--secondary" id="exportBtn">
                    <svg class="icon icon--sm"><use href="#icon-export"/></svg>
                    <span>Export</span>
                </button>
            </div>

            <div class="playback__speed">
                <span class="speed-label">Speed:</span>
                <span class="speed-value" id="speedValue">1.0x</span>
                <input type="range" class="speed-slider" id="speedSlider"
                       min="0.1" max="3" step="0.1" value="1"
                       aria-label="Playback speed">
            </div>
        </div>

        <!-- Settings Panel (Slide-in from right) -->
        <aside class="panel panel--right" id="settingsPanel" hidden>
            <div class="panel__header">
                <h2 class="panel__title">Settings</h2>
                <button class="icon-btn panel__close" aria-label="Close panel">
                    <svg class="icon"><use href="#icon-settings"/></svg>
                </button>
            </div>
            <div class="panel__content">
                <div class="setting-group">
                    <label class="setting-label">Quality</label>
                    <select class="setting-input">
                        <option value="high" selected>High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label class="setting-label">Auto-hide UI</label>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="toggle__slider"></span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">Performance mode</label>
                    <label class="toggle">
                        <input type="checkbox">
                        <span class="toggle__slider"></span>
                    </label>
                </div>
            </div>
        </aside>
    </div>

    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="loader__spinner"></div>
        <p class="loader__text">Loading kinetic magic...</p>
    </div>

    <!-- Import Maps for dependencies -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.skypack.dev/three@0.158.0",
        "load-bmfont": "https://cdn.skypack.dev/load-bmfont@2.3.4",
        "three-bmfont-text": "https://cdn.skypack.dev/three-bmfont-text@3.0.1",
        "three-bmfont-text/shaders/msdf": "https://cdn.skypack.dev/three-bmfont-text@3.0.1/shaders/msdf"
      }
    }
    </script>

    <!-- GSAP (not ESM, use global) -->
    <script src="https://unpkg.com/gsap@3.12.4/dist/gsap.min.js"></script>

    <!-- App Scripts (ES Modules) -->
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/index.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Get the base path (works for both localhost and GitHub Pages)
                const base = document.querySelector('base')?.href || window.location.pathname.replace(/\/[^\/]*$/, '/');
                const swPath = base.endsWith('/') ? base + 'sw.js' : base + '/sw.js';

                navigator.serviceWorker.register(swPath)
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
